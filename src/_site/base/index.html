<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>My Music</title>
  </head>
  <body>
    <style>
  /* Centered title */
  h1.site-title {
    text-align: center;
    margin-top: 1rem;
    font-size: 2rem;
  }

  /* Center & stretch search box */
  .search-container {
    text-align: center;
    margin: 1.5rem 0;
  }
  .search-container input {
    width: 60%;
    max-width: 500px;
    padding: 0.6rem;
    font-size: 1rem;
    border: 1px solid #888;
    border-radius: 4px;
  }

  /* Table styling */
  table#resultsTable {
    margin: 0 auto;
    border-collapse: collapse;
    width: 80%;
    max-width: 800px;
    font-family: sans-serif;
  }
  table#resultsTable th,
  table#resultsTable td {
    border: 1px solid #ccc;
    padding: 0.5rem 0.75rem;
  }
  table#resultsTable th {
    background: #f4f4f4;
  }
</style>

<h1 class="site-title">KnightChaser's Music Curation List</h1>

<div class="search-container">
  <input id="search" placeholder="Search by artist, title, mood, tag…" />
</div>

<table id="resultsTable">
  <thead>
    <tr>
      <th>Artist</th>
      <th>Title</th>
      <th>Release</th>
      <th>Mood</th>
      <th>Tags</th>
    </tr>
  </thead>
  <tbody>
    <!-- JS will populate rows here -->
  </tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/fuse.js@6"></script>
<script>
  // Escape regex special chars
  function escapeRegex(s) {
    return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }

  // Wrap matches in <strong>
  function highlight(text, term) {
    if (!term) return text;
    const re = new RegExp('(' + escapeRegex(term) + ')', 'gi');
    return text.replace(re, '<strong>$1</strong>');
  }

  fetch('/search.json')
    .then(r => r.json())
    .then(data => {
      const fuse = new Fuse(data, {
        keys: ['artist','title','mood','tags'],
        threshold: 0.3,
      });

      const input = document.getElementById('search');
      const tbody = document.querySelector('#resultsTable tbody');

      function renderResults(results, term) {
        if (!results.length) {
          tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;">No matches</td></tr>`;
          return;
        }
        tbody.innerHTML = results.map(h => {
          const item = h.item;
          // Join arrays into comma-lists
          const mood = Array.isArray(item.mood) ? item.mood.join(', ') : item.mood;
          const tags = Array.isArray(item.tags) ? item.tags.join(', ') : item.tags;
          // Highlight search term
          const t = term.trim();
          return `
            <tr>
              <td>${highlight(item.artist, t)}</td>
              <td>${highlight(item.title, t)}</td>
              <td>${highlight(item.release, t)}</td>
              <td>${highlight(mood, t)}</td>
              <td>${highlight(tags, t)}</td>
            </tr>`;
        }).join('');
      }

      // Initial empty state
      tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;">Type to search…</td></tr>`;

      input.addEventListener('input', e => {
        const term = e.target.value;
        const results = term
          ? fuse.search(term)
          : [];
        renderResults(results, term);
      });
    });
</script>
  </body>
</html>

