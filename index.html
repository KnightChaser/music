<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">

        
        <link rel="icon" href="/music/assets/images/favicon.ico" type="image/x-icon">
        <title>KnightChaser's Music Curation</title>

        <link rel="stylesheet" href="/music/assets/css/style.css">
    </head>
    <body class="font-sans bg-white text-gray-800">
        
<header class="relative">
  <!-- Site title -->
  <h1 class="mt-4 text-2xl font-bold text-center">
    KnightChaser's Music Curation List
  </h1>

  <!-- Call-to-action: file an issue -->
  <div class="mt-2 text-center">
    <a href="https://github.com/KnightChaser/music/issues" target="_blank" class="inline-block text-sm font-medium text-red-600 hover:underline animate-pulse" aria-label="Suggest a new song or report wrong info">
      ğŸ” Found a mistake or have a killer track to add? File an issue!
    </a>
  </div>

  <!-- GitHub link in the top-right -->
  <a href="https://github.com/KnightChaser/music" target="_blank" aria-label="Music Repo on GitHub" class="absolute top-4 right-4">
    <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" class="w-8 h-8">
  </a>
</header>


<div id="count" class="text-center mb-2 text-base text-gray-600">
  0 / 0 songs shown
</div>


<div class="flex justify-center my-6 px-4">
  <div class="relative w-full max-w-4xl">
    <!-- Search field wrapper -->
    <div class="relative">
      <!-- Left search icon -->
      <div class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
          <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"></path>
        </svg>
      </div>

      <input id="search" type="text" placeholder="artist:..., title:..., tags:..., note:..., language:..." autocomplete="off" class="block w-full pl-12 pr-24 py-4 text-xl text-gray-900
               border border-red-500 rounded-lg
               focus:border-red-600 focus:ring-red-600 transition">

      <!-- Reset button -->
      <button id="clear" type="button" class="absolute inset-y-0 right-0 flex items-center justify-center
               px-6 py-4 bg-red-600 text-white rounded-r-lg
               hover:bg-red-700 focus:outline-none focus:ring-4 focus:ring-red-200
               transition">
        reset
      </button>

      <!-- Suggestions dropdown -->
      <div id="suggestions" class="absolute z-50 mt-1 w-full max-h-80 overflow-auto rounded-b-lg
               border border-t-0 border-gray-300 bg-white shadow-lg" style="display: none;"></div>
    </div>
  </div>
</div>

<div class="px-4 sm:px-6 lg:px-8">
  <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
    <table id="resultsTable" class="w-full text-lg text-black bg-white border-collapse border border-gray-200">
      <thead class="text-lg text-black uppercase bg-gray-100">
        <tr>
          <th scope="col" data-key="artist" class="w-2/12 sortable px-6 py-3 text-center border-b border-gray-200">
            <div class="flex items-center justify-center">
              Artist
              <span class="sort-indicator ml-1">â‡…</span>
            </div>
          </th>
          <th scope="col" data-key="title" class="w-3/12 sortable px-6 py-3 text-center border-b border-gray-200">
            <div class="flex items-center justify-center">
              Song
              <span class="sort-indicator ml-1">â‡…</span>
            </div>
          </th>
          <th scope="col" data-key="release" class="w-1/12 sortable px-6 py-3 text-center border-b border-gray-200">
            <div class="flex items-center justify-center">
              Release
              <span class="sort-indicator ml-1">â‡…</span>
            </div>
          </th>
          <th scope="col" class="w-3/12 px-6 py-3 text-center border-b border-gray-200">
            Tags
          </th>
          <th scope="col" class="w-2/12 px-6 py-3 text-center border-b border-gray-200">
            Note
          </th>
          <th scope="col" data-key="language" class="w-1/12 sortable px-6 py-3 text-center border-b border-gray-200">
            <div class="flex items-center justify-center">
              Language
              <span class="sort-indicator ml-1">â‡…</span>
            </div>
          </th>
        </tr>
      </thead>
      <tbody class="divide-y">
        <tr>
          <td colspan="6" class="px-6 py-4 text-center text-black/50">
            Loadingâ€¦
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>


<button id="backToTop" aria-label="Back to top" class="fixed bottom-6 right-6 w-12 h-12 bg-red-600 text-white rounded-full shadow-md
         flex items-center justify-center opacity-0 pointer-events-none
         transition-opacity duration-300 ease-in-out">
  TOP
</button>

<script>
const btn = document.getElementById('backToTop');
window.addEventListener('scroll', () => {
  if (window.scrollY > 300) {
    btn.classList.remove('opacity-0', 'pointer-events-none');
    btn.classList.add('opacity-100', 'pointer-events-auto');
  } else {
    btn.classList.remove('opacity-100', 'pointer-events-auto');
    btn.classList.add('opacity-0', 'pointer-events-none');
  }
});
btn.addEventListener('click', () => {
  window.scrollTo({ top: 0, behavior: 'smooth' });
});
</script>


<script>
  const langEmoji = {
    en: 'ğŸ‡ºğŸ‡¸', pt: 'ğŸ‡µğŸ‡¹', ja: 'ğŸ‡¯ğŸ‡µ', es: 'ğŸ‡ªğŸ‡¸', fr: 'ğŸ‡«ğŸ‡·',
    ko: 'ğŸ‡°ğŸ‡·', ru: 'ğŸ‡·ğŸ‡º', zh: 'ğŸ‡¨ğŸ‡³', de: 'ğŸ‡©ğŸ‡ª', sv: 'ğŸ‡¸ğŸ‡ª',
    th: 'ğŸ‡¹ğŸ‡­', cn: 'ğŸ‡¨ğŸ‡³', vn: 'ğŸ‡»ğŸ‡³',
    none: 'ğŸ’­'
  };
  
  const langNames = {
    en: ['English'], pt: ['PortuguÃªs', 'Portuguese'], ja: ['æ—¥æœ¬èª', 'Japanese'],
    es: ['EspaÃ±ol', 'Spanish'], fr: ['FranÃ§ais', 'French'],
    ko: ['í•œêµ­ì–´', 'Korean'], ru: ['Ğ ÑƒÑÑĞºĞ¸Ğ¹', 'Russian'], zh: ['ä¸­æ–‡', 'Chinese'],
    de: ['Deutsch', 'German'], sv: ['Svenska', 'Swedish'], th: ['à¹„à¸—à¸¢', 'Thai'],
    cn: ['ä¸­æ–‡', 'Chinese'], vn: ['Tiáº¿ng Viá»‡t', 'Vietnamese'],
    none: ['None', 'No specific language']
  };

  // Fuzzy matching function (very cheap)
  // This function checks if the pattern can be found in the text in order
  function fuzzyMatch(pattern, text) {
    pattern = pattern.toLowerCase();
    text    = text.toLowerCase();
    let i = 0, j = 0;
    while (i < pattern.length && j < text.length) {
      if (pattern[i] === text[j]) i++;
      j++;
    }
    return i === pattern.length;
  }

  function parseCriteria(str) {
    return str.split(',').map(s => s.trim()).filter(s => s.includes(':')).reduce((a,p) => {
      const [k, ...r] = p.split(':');
      const key = k.trim().toLowerCase();
      const val = r.join(':').trim().toLowerCase();
      if (key && val) a[key] = val;
      return a;
    }, {});
  }

  function filterData(data, criteria) {
    return data.filter(item => Object.entries(criteria).every(([k,v]) => {
      const needle = v.trim();
      switch (k) {
        case 'artist': 
          return fuzzyMatch(needle, item.artist);
        case 'title': 
          return fuzzyMatch(needle, item.title);
        case 'release': 
          return fuzzyMatch(needle, item.release);
        case 'tags': 
          return item.tags.some(t => fuzzyMatch(needle, t));
        case 'note': 
          return fuzzyMatch(needle, item.note || '');
        case 'language': 
          return item.language && item.language.toLowerCase() === needle;
        default: return false;
      }
    }));
  }

  fetch('/music/search.json')
    .then(r => r.json())
    .then(data => {
      const input = document.getElementById('search');
      const clearBtn = document.getElementById('clear');
      const suggestionsBox = document.getElementById('suggestions');
      const total = data.length;
      const tbody = document.querySelector('#resultsTable tbody');
      const countEl = document.getElementById('count');
      const tagCounts = data.flatMap(d=>d.tags)
        .reduce((a,t)=>(a[t]=(a[t]||0)+1,a),{});
      const artistCounts = data.reduce((a,d)=>(a[d.artist]=(a[d.artist]||0)+1,a),{});
      const languageCounts = data.reduce((a,d)=>(d.language&&(a[d.language]=(a[d.language]||0)+1),a),{});
      const countsMap = { tags: tagCounts, artist: artistCounts, language: languageCounts };


      const sources = {
        artist: Array.from(new Set(data.map(d => d.artist))).sort(),
        title: Array.from(new Set(data.map(d => d.title))).sort(),
        tags: Array.from(new Set(data.flatMap(d => d.tags))).sort(),
        language: Array.from(new Set(data.map(d => d.language).filter(l => l))).sort(),
        note: Array.from(new Set(data.map(d => d.note).filter(n => n))).sort()
      };


      let current = [];
      let sortKey = 'release', sortDir = -1;
      let selectedIndex = -1;

      function updateCount() {
        countEl.textContent = `${current.length} / ${total} songs shown`;
      }

      function applySort() {
        current.sort((a, b) => {
          let av = a[sortKey], bv = b[sortKey];
          if (sortKey === 'release') {
            av = new Date(av);
            bv = new Date(bv);
          } else {
            av = String(av).toLowerCase();
            bv = String(bv).toLowerCase();
          }
          return (av < bv ? -1 : av > bv ? 1 : 0) * sortDir;
        });
      }

      function render() {
        if (!current.length) {
          tbody.innerHTML = `
            <tr>
              <td colspan="7" style="text-align:center;">No matches</td>
            </tr>`;
          updateCount();
          return;
        }
        tbody.innerHTML = current.map(item => {
          const tagsHtml = item.tags.slice().sort().map(t =>
            `
            <span class="clickable inline-block bg-blue-100 rounded px-2 py-1 font-bold hover:bg-blue-200 cursor-pointer transition-colors" data-field="tags" data-term="${t}">#${t} (${tagCounts[t]})</span>`
          ).join(' ');

          // Compute relative release time
          const releaseDate = new Date(item.release);
          const now = new Date();
          const diffDays = Math.floor((now - releaseDate) / (1000*60*60*24));
          const diffYears = (diffDays/365).toFixed(2);
          const releaseHtml = `
            <span class="relative inline-block group cursor-default">
              <span>${item.release}</span>
              <div
                class="absolute bottom-full mb-1 left-1/2 transform -translate-x-1/2
                       hidden group-hover:block bg-gray-800 text-white text-xs rounded
                       p-2 whitespace-pre-line text-center z-10 w-max px-2"
              >${diffDays} days ago\n(${diffYears} years ago)</div>
            </span>
          `;

          const listenHtml = (item.listen || []).map(entry => {
            const key = Object.keys(entry)[0];
            const url = entry[key];
            let emoji = '', bg = '', color = '#000';

            if (key === 'ORG')            { emoji = 'ğŸ§'; bg = '#e0e0e0'; }
            else if (key.startsWith('RX')){ emoji = 'ğŸ”€'; bg = '#e0f7fa'; color = '#006064'; }
            else if (key === 'NCR')       { emoji = 'âš¡'; bg = '#fff8e1'; color = '#ff6f00'; }

            const hover = key === 'ORG'
              ? 'Listen to the original song'
              : key.startsWith('RX')
                ? `Listen to the remix version${ key.includes('(') ? ' (' + key.match(/\((.*)\)/)[1] + ')' : '' }`
                : 'Listen to the nightcore version';

             return `
              <span class="relative inline-block group">
                <a
                  href="${url}"
                  class="rounded px-2 py-1 font-bold text-sm transition-colors group-hover:bg-blue-300 cursor-pointer clickable"
                  style="background:${bg}; color:${color};"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  ${key} ${emoji}
                </a>
                <div
                  class="absolute bottom-full mb-1 left-1/2 transform -translate-x-1/2
                         hidden group-hover:block bg-gray-800 text-white text-xs
                         rounded p-2 px-4 w-max max-w-sm whitespace-pre-line text-center z-10">${hover}</div>
              </span>
            `;
          }).join(' ');

          const lang = item.language || '';
          const names = langNames[lang] || ['', ''];
          const titleAttr = names.join('\n');
          const badge = lang
            ? `
              <span class="relative inline-block group">
                <!-- the pill itself -->
                <span
                  class="clickable inline-block bg-blue-100 rounded px-2 py-1 font-bold hover:bg-blue-200 cursor-pointer transition-colors lang-badge"
                  data-field="language"
                  data-term="${lang}"
                >
                  ${lang}${langEmoji[lang] || ''}
                </span>
                <!-- tooltip: hidden until hover -->
                <div
                  class="absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2
                         hidden group-hover:block px-2 py-1 text-sm text-white bg-gray-800
                         rounded whitespace-pre-line text-center z-10"
                > ${langEmoji[lang] || ''}
                  ${langNames[lang][0]}
                    ${lang !== 'en'
                    ? `${langNames[lang][1] || langNames[lang][0]} (${lang})`
                    : `(${lang})`}
                </div>
              </span>
            `
            : '';

          return `
            <tr>
              <td class="px-6 py-4 text-center">
                <span class="clickable inline-block bg-blue-100 rounded px-2 py-1 font-bold hover:bg-blue-200 cursor-pointer transition-colors" data-field="artist" data-term="${item.artist}" style="margin-right:0.25rem; margin-bottom:0.15rem;">${item.artist}</span>
              </td>
              <td class="px-6 py-4 text-center align-center">
                <!-- SONG title a bit larger -->
                <div
                  class="text-xl font-semibold copy-title cursor-pointer transition-transform duration-150 hover:scale-110"
                  title="Click to copy">
                  ${item.title}
                </div>
                <!-- badges stacked, centered, with a little gap -->
                <div class="mt-2 flex flex-col items-center space-y-1">
                  ${listenHtml}
                </div>
              </td>
              <td class="px-6 py-4 text-center whitespace-nowrap">
                   ${releaseHtml}
              </td>
              <td class="px-6 py-4 text-left">
                   ${item.tags.slice().sort().map(t =>
                    `<span class="clickable inline-block bg-blue-100 rounded px-2 py-1 font-bold hover:bg-blue-200 cursor-pointer transition-colors" data-field="tags" data-term="${t}" style="margin-right:0.25rem; margin-bottom:0.15rem;">#${t} (${tagCounts[t]})</span>`
                   ).join(' ')}
              </td>
              <td class="px-6 py-4 text-left">
                   ${item.note || 'N/A'}
              </td>
              <td class="px-6 py-4 text-center">
                   ${badge}
              </td>
            </tr>`;
        }).join('');
        updateCount();
      }

      function doSearch() {
        const criteria = parseCriteria(input.value);
        current = filterData(data, criteria);
        applySort();
        render();
        suggestionsBox.style.display = 'none'; // Hide suggestions after search
      }

      function updateSuggestions() {
        const raw = input.value;
        const lastSeg = raw.includes(',')
          ? raw.slice(raw.lastIndexOf(',') + 1).trim()
          : raw.trim();
        const m = lastSeg.match(/^(\w+):\s*([^,]*)$/);

        if (!m) {
          suggestionsBox.style.display = 'none';
          return;
        }

        const field = m[1].toLowerCase();
        const term  = m[2].toLowerCase();
        const countsMap = { artist: artistCounts, tags: tagCounts, language: languageCounts };
        const rawList   = sources[field] || [];
        const counts    = countsMap[field] || {};

        const matches = rawList
          .filter(v => fuzzyMatch(term, v))
          .sort((a, b) => (counts[b] || 0) - (counts[a] || 0) || a.localeCompare(b))
          .slice(0, 50);

        if (!matches.length) {
          suggestionsBox.style.display = 'none';
          return;
        }

        suggestionsBox.innerHTML = matches.map((v, i) => {
      
        // escape user input for regex
        const esc = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        const regex = new RegExp(`(${esc})`, 'ig');

        // wrap the matched substring in <strong>
        const highlighted = v.replace(regex, '<strong>$1</strong>');

        return `
          <div
            data-val="${field}:${v}"
            data-index="${i}"
            tabindex="0"
            class="flex justify-between px-4 py-2 hover:bg-gray-100 cursor-pointer"
          >
            <span><strong>${field}:</strong> ${highlighted}</span>
            <span class="ml-2 text-gray-500">(${counts[v] || 0} matches)</span>
          </div>
          `;
        }).join('');

        selectedIndex = -1;
        suggestionsBox.style.display = 'block';
      }

      // Event Listeners
      input.addEventListener('input', () => {
        doSearch();
        updateSuggestions();
      });

      input.addEventListener('keydown', e => {
        const items = Array.from(suggestionsBox.children);
        if (!items.length || suggestionsBox.style.display !== 'block') return;
      
        if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
          e.preventDefault();
          let idx = selectedIndex;
          if (e.key === 'ArrowDown')   idx = (idx + 1) % items.length;
          else if (e.key === 'ArrowUp') idx = (idx - 1 + items.length) % items.length;
      
          // clear, highlight, and scroll into view
          items.forEach(i => i.classList.remove('bg-gray-200'));
          items[idx].classList.add('bg-gray-200');
          items[idx].scrollIntoView({ block: 'nearest' });
      
          selectedIndex = idx;
        } else if (e.key === 'Enter' && selectedIndex > -1) {
          e.preventDefault();
          items[selectedIndex].click();
          selectedIndex = -1;
        }
      });

      clearBtn.addEventListener('click', () => {
        input.value = '';
        doSearch();
        suggestionsBox.style.display = 'none';
        input.focus();
      });

      suggestionsBox.addEventListener('click', e => {
        const val = e.target.closest('div')?.dataset.val;
        if(val){
          const parts = input.value.split(',').map(s => s.trim()).filter(s => s);
          const [field, term] = val.split(':');
          const filtered = parts.filter(p => !p.toLowerCase().startsWith(field + ':'));
          input.value = filtered.join(', ') + (filtered.length ? ', ' : '') + val;
          doSearch(); // Perform search immediately after selecting a suggestion
          suggestionsBox.style.display = 'none'; // Hide suggestions after selection
        }
      });

      // Initial render on page load
      doSearch();

      document.querySelectorAll('th.sortable').forEach(th => th.addEventListener('click', () => {
        const key = th.dataset.key;
        if (sortKey === key) sortDir *= -1;
        else { sortKey = key; sortDir = 1; }
        document.querySelectorAll('th.sortable').forEach(h => h.style.fontWeight = 'normal');
        th.style.fontWeight = 'bold';
        applySort();
        render();
      }));

      document.querySelector('#resultsTable tbody').addEventListener('click', e => {
        if (e.target.classList.contains('clickable') && e.target.dataset.field) {
          const f = e.target.dataset.field, t = e.target.dataset.term;
          const parts = input.value.split(',').map(s => s.trim()).filter(s => s);
          const filtered = parts.filter(p => !p.toLowerCase().startsWith(f + ':'));
          filtered.push(`${f}:${t}`);
          input.value = filtered.join(', ');
          doSearch();
        }
      });

      document
        .getElementById('resultsTable')
        .addEventListener('click', e => {
          if (!e.target.classList.contains('copy-title')) return;

          const txt = e.target.textContent.trim();
          navigator.clipboard.writeText(txt).then(() => {
            const toastEl = document.getElementById('toast-default');
            // show
            toastEl.classList.remove('hidden');
            // auto-hide after 2s
            setTimeout(() => toastEl.classList.add('hidden'), 2000);
          });
      });


      const btn = document.getElementById('backToTop');
      window.addEventListener('scroll', () => { btn.style.display = window.scrollY > 300 ? 'block' : 'none'; });
      btn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
    });

</script>

        <script src="/music/assets/flowbite/flowbite.min.js"></script>

        <!-- hidden by default -->
        <div id="toast-default" class="hidden fixed top-5 right-5 z-50 w-full max-w-xs p-4 text-gray-500 bg-white rounded-lg shadow-sm dark:text-gray-400 dark:bg-gray-800 flex items-center" role="alert">
            <div class="inline-flex items-center justify-center shrink-0 w-8 h-8 text-blue-500 bg-blue-100 rounded-lg dark:bg-blue-800 dark:text-blue-200">
                <!-- Clipboard icon -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" fill="currentColor" class="w-4 h-4">
                    <!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                    <path d="M320 64h-56.81C259.06 46.42 242.06 32 224 32h-64c-18.06 0-35.06 14.42-39.19 32H64C28.65 64 0 92.65 0 128v320c0 35.35 28.65 64 64 64h256c35.35 0 64-28.65 64-64V128c0-35.35-28.65-64-64-64zM160 48h64c8.82 0 16 7.18 16 16s-7.18 16-16 16h-64c-8.82 0-16-7.18-16-16s7.18-16 16-16zm192 400c0 17.64-14.36 32-32 32H64c-17.64 0-32-14.36-32-32V128c0-17.64 14.36-32 32-32h56.81c4.13 17.58 21.13 32 39.19 32h64c18.06 0 35.06-14.42 39.19-32H320c17.64 0 32 14.36 32 32v320z"></path>
                </svg>
                <span class="sr-only">Clipboard icon</span>
            </div>
            <div class="ms-3 text-sm font-normal flex-1">Title copied!</div>
            <button type="button" class="ms-auto -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex items-center justify-center h-8 w-8 dark:text-gray-500 dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700" data-dismiss-target="#toast-default" aria-label="Close">
                <span class="sr-only">Close</span>
                <svg class="w-2 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1l12 12M13 1L1 13"></path>
                </svg>
            </button>
        </div>
    </body>
</html>
